<script>
    // AnkiMobile fix
    console.warn = console.error = console.log

    var codeWindow;
    var outputWindow;
    var pyodide;
    var expandedCodeWindow = false;
    var expandedOutWindow = false;

    function decodeHtml(html) {
        var txt = document.createElement("textarea");
        txt.innerHTML = html;
        return txt.value;
    }

    var codeSnippets = decodeHtml(`{{CodeSnippets}}`);

    var injectScript = (src) => {
        return new Promise((resolve, reject) => {
            // Check if script already exists
            const existingScript = document.querySelector(`script[src="${src}"]`);
            if (existingScript) {
                resolve();
                return;
            }

            const script = document.createElement('script');
            script.src = src;
            script.async = true;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    };

    async function load() {
        await injectScript('_codemirror.js');
        await injectScript('_python-codemirror.js');
        await injectScript('_pyodide.js');
        await injectScript('_katex.min.js');
        await injectScript('_highlight.min.js');
        await injectScript('_python.min.js');
    }

    function setup() {
        hljs.highlightAll();

        codeWindow = CodeMirror(document.getElementById('code_window'), {
            lineNumbers: true,
            tabSize: 2,
            value: codeSnippets,
            mode: 'python',
            theme: 'nord'
        });

        outputWindow = CodeMirror(document.getElementById('output_window'), {
            lineNumbers: false,
            tabSize: 2,
            value: '',
            mode: 'python',
            theme: 'nord',
        });

        outputWindow.setSize(null, 100);

        if (Persistence.isAvailable()) {
            codeWindow.on("change", function (instance, changeObj) {
                var data = Persistence.setItem(`{{TitleSlug}}`, codeWindow.getValue())
            });
        }
    }

    load().then(() => {
        setup()

        setTimeout(() => {
            codeWindow.refresh()
            outputWindow.refresh()
        }, 30)

    })
</script>

<script>
    function expandTags() {
        document.getElementById('hidden-tags').style.display = 'none';
        const tagData = JSON.parse(JSON.stringify({{ TopicTags }}));
    const tagSlugs = Object.keys(tagData);
    const tags = Object.values(tagData);

    const N = tags.length;
    for (let i = 0; i < N; i++) {
        const tag = document.createElement('a');
        tag.setAttribute('class', 'btn tag-btn');
        tag.setAttribute('href', 'https://leetcode.com/tag/' + tagSlugs[i] + '/');
        tag.innerHTML = tags[i];
        document.getElementById('tags').appendChild(tag);
    }
    }
</script>

<!--Problem Title-->
<section class="RankEditor"
    style="margin: 0px auto; text-align: center; width: 100%; opacity: 1; transform: rotateZ(0deg);" data-width="100%"
    data-opacity="1" data-rotate="0">
    <section
        style="color: rgb(228, 130, 16); padding: 3px 10px; margin-bottom: -1em; vertical-align: bottom; font-size: 1.2em;">
        <p class="brush active" style="color: rgb(228, 130, 16); font-size: 19px; min-width: 1px;">
            <a href="https://leetcode.com/problems/{{TitleSlug}}" style="text-decoration:none;color:rgb(228, 130, 16);">
                {{Id}}. {{Title}}
            </a>
        </p>
    </section>
    <section style="width: 100%; display: inline-block; vertical-align: top;">
        <section
            style="border-top: 1px solid rgb(228, 130, 16); border-right-color: rgb(228, 130, 16); border-bottom-color: rgb(228, 130, 16); border-left-color: rgb(228, 130, 16); width: 100%;">
        </section>
        <section
            style="width: 6px; height: 6px; margin-top: -3px; background-color: rgb(228, 130, 16); border-radius: 100%;">
        </section>
        <section
            style="width: 6px; height: 6px; margin-top: -6px; float: right; background-color: rgb(228, 130, 16); border-radius: 100%;">
        </section>
    </section>
</section>

{{#Tags}}
<div id="tags"></div>
<a class="btn tag-btn" href="#" onclick="expandTags()" id="hidden-tags">Tags</a>
{{/Tags}}

{{Description}}

<!--Code Snippets-->
<div id="codeSnippets-container">
    <section class="RankEditor"
        style="margin: 0px auto; text-align: center; width: 100%; opacity: 1; transform: rotateZ(0deg);"
        data-width="100%" data-opacity="1" data-rotate="0">
        <section
            style="color: rgb(228, 130, 16); padding: 3px 10px; margin-bottom: -1em; vertical-align: bottom; font-size: 1.2em;">
            <p class="brush active" style="color: rgb(228, 130, 16); font-size: 19px; min-width: 1px;">
                Code Editor
            </p>
        </section>
        <section style="width: 100%; display: inline-block; vertical-align: top;">
            <section
                style="border-top: 1px solid rgb(228, 130, 16); border-right-color: rgb(228, 130, 16); border-bottom-color: rgb(228, 130, 16); border-left-color: rgb(228, 130, 16); width: 100%;">
            </section>
            <section
                style="width: 6px; height: 6px; margin-top: -3px; background-color: rgb(228, 130, 16); border-radius: 100%;">
            </section>
            <section
                style="width: 6px; height: 6px; margin-top: -6px; float: right; background-color: rgb(228, 130, 16); border-radius: 100%;">
            </section>
        </section>
    </section>
</div>

<script>
    // v1.1.8 - https://github.com/SimonLammer/anki-persistence/blob/584396fea9dea0921011671a47a0fdda19265e62/script.js
    if (void 0 === window.Persistence) { var e = "github.com/SimonLammer/anki-persistence/", t = "_default"; if (window.Persistence_sessionStorage = function () { var i = !1; try { "object" == typeof window.sessionStorage && (i = !0, this.clear = function () { for (var t = 0; t < sessionStorage.length; t++) { var i = sessionStorage.key(t); 0 == i.indexOf(e) && (sessionStorage.removeItem(i), t--) } }, this.setItem = function (i, n) { void 0 == n && (n = i, i = t), sessionStorage.setItem(e + i, JSON.stringify(n)) }, this.getItem = function (i) { return void 0 == i && (i = t), JSON.parse(sessionStorage.getItem(e + i)) }, this.removeItem = function (i) { void 0 == i && (i = t), sessionStorage.removeItem(e + i) }, this.getAllKeys = function () { for (var t = [], i = Object.keys(sessionStorage), n = 0; n < i.length; n++) { var s = i[n]; 0 == s.indexOf(e) && t.push(s.substring(e.length, s.length)) } return t.sort() }) } catch (n) { } this.isAvailable = function () { return i } }, window.Persistence_windowKey = function (i) { var n = window[i], s = !1; "object" == typeof n && (s = !0, this.clear = function () { n[e] = {} }, this.setItem = function (i, s) { void 0 == s && (s = i, i = t), n[e][i] = s }, this.getItem = function (i) { return void 0 == i && (i = t), void 0 == n[e][i] ? null : n[e][i] }, this.removeItem = function (i) { void 0 == i && (i = t), delete n[e][i] }, this.getAllKeys = function () { return Object.keys(n[e]) }, void 0 == n[e] && this.clear()), this.isAvailable = function () { return s } }, window.Persistence = new Persistence_sessionStorage, Persistence.isAvailable() || (window.Persistence = new Persistence_windowKey("py")), !Persistence.isAvailable()) { var i = window.location.toString().indexOf("title"), n = window.location.toString().indexOf("main", i); i > 0 && n > 0 && n - i < 10 && (window.Persistence = new Persistence_windowKey("qt")) } }
</script>

<section class="container text-center">
    <div class="coditer">
        <div class="coditer-content">
            <div class="editor-title">
                Code
                <span class="editor-buttons">
                    <span id="loading_icon" style="display: none;"><i class="material-symbols-outlined loading"
                            style="color: #4caf50;">progress_activity</i></span>
                    <span onclick="runCode();"><i class="material-symbols-outlined"
                            style="color: #4caf50;">play_circle</i></span>
                    <span onclick="runTestCase();"><i class="material-symbols-outlined"
                            style="color: #03A9F4;">check_circle</i></span>
                    <span onclick="expandCodeWindow();" class="expand-button" id="expand_button"><i
                            class="material-symbols-outlined">expansion_panels</i></span>
                    <span onclick="loadPyodideInBrowser();" class="start-button" id="start_button">
                        <i class="material-symbols-outlined">power_settings_circle</i>
                    </span>
                </span>
            </div>
            <div id="code_window"></div>
        </div>

        <div class="coditer-content">
            <div class="editor-title">Output
                <span class="editor-buttons">
                    <span onclick="expandOutputWindow();"><i
                            class="material-symbols-outlined">expansion_panels</i></span>
                    <span onclick="clearConsole();" class="clear-button" id="clear_button"><i
                            class="material-symbols-outlined">delete</i></span>
                </span>
            </div>
            <div id="output_window"></div>
        </div>
    </div>

</section>

{{Hints}}

<script>
    var connectBtn = document.getElementById("start_button")

    async function main() {
        if (window.pyodide) {
            return;
        }

        var loadingIcon = document.getElementById("loading_icon")
        loadingIcon.style.display = "unset";

        window.pyodide = await loadPyodide({
            indexURL: "https://cdn.jsdelivr.net/pyodide/v0.29.0/full/",
            stdin: window.prompt,
            stdout: (text) => {
                var currentValue = outputWindow.getValue();
                outputWindow.setValue(currentValue + text + '\n');
            },
            stderr: (text) => {
                var currentValue = outputWindow.getValue();
                outputWindow.setValue(currentValue + text + '\n');
            }
        });

        console.log("Pyodide Loaded");
        connectBtn.style.color = "#4caf50";
        loadingIcon.style.display = "none";
    }

    function loadPyodideInBrowser() {
        if (window.pyodide) {
            connectBtn.style.color = "#4caf50";
            return
        }

        main();
    }

    function runCode() {
        clearConsole();

        if (!window.pyodide) {
            outputWindow.setValue("Please start Pyodide first by clicking the power button.");
            return;
        }

        try {
            code = codeWindow.getValue();
            var codeToRun = 'from typing import *\n' + code
            window.pyodide.runPython(codeToRun);
        } catch (err) {
            var currentValue = outputWindow.getValue();
            outputWindow.setValue(currentValue + String(err) + '\n');
            expandOutputWindow()
        }
    }


    var pythonCodeTestCaseRunner = `
def run_tests(candidate, test_cases):
    passed = 0
    failed = 0
    failed_cases = []

    for i, test in enumerate(test_cases, 1):
        *inputs, expected = test
        result = candidate(*inputs)
        
        if result == expected:
            passed += 1
        else:
            failed += 1
            failed_cases.append({
                'test_num': i,
                'inputs': inputs,
                'expected': expected,
                'got': result
            })
    
    print(f'''{passed}/{len(test_cases)} tests passed''')
    
    if failed > 0:
        print(f'''\\n{failed} test(s) failed:''')
        for case in failed_cases:
            print(f'''  Test #{case['test_num']}:''')
            print(f'''    Input: {case['inputs']}''')
            print(f'''    Expected: {case['expected']}''')
            print(f'''    Got: {case['got']}''')
    else:
        print('''All tests passed! âœ“''')
    
    return passed == len(test_cases)

def check(candidate):
    return run_tests(candidate, test_cases)
`;


    function runTestCase() {
        clearConsole();

        if (!window.pyodide) {
            outputWindow.setValue("Please start Pyodide first by clicking the power button.");
            return;
        }

        try {
            code = codeWindow.getValue();

            var prompt = decodeHtml(`{{Prompt}}`);
            var testCode = decodeHtml(`{{TestCode}}`);
            var entryPoints = decodeHtml(`{{EntryPoint}}`);
            var entryCode = `check(${entryPoints})\n`;

            var codeToRun = prompt + pythonCodeTestCaseRunner + code + testCode + entryCode;
            window.pyodide.runPython(codeToRun);

        } catch (err) {
            var currentValue = outputWindow.getValue();
            outputWindow.setValue(currentValue + String(err) + '\n');
            expandOutputWindow()
        }
    }

    function clearConsole() {
        outputWindow.setValue("")
    }

    function expandCodeWindow() {
        expandedCodeWindow = !expandedCodeWindow;
        var expandedCodeValue = expandedCodeWindow ? 500 : 300;
        codeWindow.setSize(null, expandedCodeValue);
    }

    function expandOutputWindow() {
        expandedOutWindow = !expandedOutWindow;
        var expandedOutValue = expandedOutWindow ? 360 : 100;
        outputWindow.setSize(null, expandedOutValue);
    }
</script>